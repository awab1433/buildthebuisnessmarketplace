<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Business Listings</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .card { border: 1px solid #ccc; border-radius: 10px; padding: 1em; width: 250px; margin: 10px; background: #fff; cursor: pointer; }
    .grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .detail { margin-top: 20px; }
    #backBtn { cursor: pointer; color: blue; text-decoration: underline; margin-bottom: 10px; display: none; }
    select { margin: 10px 0; padding: 5px; }
  </style>
</head>
<body>
  <h1>Business Listings</h1>

  <label for="industryFilter">Filter by Industry:</label>
  <select id="industryFilter">
    <option value="All">All</option>
  </select>

  <label for="sortSelect">Sort by Price:</label>
  <select id="sortSelect">
    <option value="asc">Low to High</option>
    <option value="desc">High to Low</option>
  </select>

  <div id="backBtn" onclick="goBack()">‚Üê Back to Listings</div>
  <div id="listing-container" class="grid"></div>
  <div id="detail-container" style="display:none;"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCzGs2cQRjE7z3UZ6UQCMtvqaI1tXooFNs",
      authDomain: "buildthebuisnessmarketplace.firebaseapp.com",
      projectId: "buildthebuisnessmarketplace",
      storageBucket: "buildthebuisnessmarketplace.appspot.com",
      messagingSenderId: "925773535893",
      appId: "1:925773535893:web:6572609247d9851866599c",
      measurementId: "G-W35X960PF1",
      databaseURL: "https://buildthebuisnessmarketplace-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let listings = [];

    async function fetchListings() {
      const snapshot = await get(ref(db, 'listings'));
      if (snapshot.exists()) {
        listings = Object.values(snapshot.val());
        populateFilters();
        showIndex();
      }
    }

    function populateFilters() {
      const select = document.getElementById("industryFilter");
      const industries = [...new Set(listings.map(l => l.Industry))];
      industries.forEach(ind => {
        const option = document.createElement("option");
        option.value = ind;
        option.textContent = ind;
        select.appendChild(option);
      });
    }

    function showIndex() {
      const container = document.getElementById("listing-container");
      const detail = document.getElementById("detail-container");
      const back = document.getElementById("backBtn");
      detail.style.display = "none";
      container.style.display = "flex";
      back.style.display = "none";

      container.innerHTML = "";

      const filter = document.getElementById("industryFilter").value;
      const sort = document.getElementById("sortSelect").value;

      let filtered = filter === "All" ? listings : listings.filter(l => l.Industry === filter);

      if (sort === "asc") filtered.sort((a, b) => a.Price - b.Price);
      else filtered.sort((a, b) => b.Price - a.Price);

      filtered.forEach((item, index) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${item.Image}" alt="Image" style="width:100%; border-radius:8px;">
          <h3>${item.Name}</h3>
          <p><strong>Price:</strong> $${item.Price}</p>
          <p><strong>Industry:</strong> ${item.Industry}</p>
        `;
        card.onclick = () => showDetail(item);
        container.appendChild(card);
      });
    }

    function showDetail(item) {
      const container = document.getElementById("detail-container");
      document.getElementById("listing-container").style.display = "none";
      document.getElementById("backBtn").style.display = "block";
      container.style.display = "block";

      container.innerHTML = `
        <div class="detail">
          <h2>${item.Name}</h2>
          <img src="${item.Image}" style="width:100%; max-width:600px; border-radius:8px;">
          <p><strong>Price:</strong> $${item.Price}</p>
          <p><strong>Location:</strong> ${item.Location}</p>
          <p><strong>Industry:</strong> ${item.Industry}</p>
          <p><strong>Condition:</strong> ${item.Condition}</p>
          <p><strong>Description:</strong> ${item.Description}</p>
        </div>
      `;
    }

    function goBack() {
      showIndex();
    }

    document.getElementById("industryFilter").onchange = showIndex;
    document.getElementById("sortSelect").onchange = showIndex;

    fetchListings();
  </script>
</body>
</html>
